## 1.1 Обоснованность разработки продукта 

- Базовая информация: Есть салон для продажи автомобилей марки Mercedes. У салона есть сайт. Информационный сервис 
работает не 24/7, а консультация пользователей нужна все время. Было принято решение создать онлайн помощника методом
внедрения нейронных сетей.
- Бизнес цель: Создать веб-сервис(Language Model Assistant) для дальнейшей возможности включения его в веб-сайт или 
веб-приложения с целью улучшения обслуживания клиентов
- Побочные цели: Сервис поддержки клиентов не может работать круглосуточно. ВОбеспечить непрерывное взаимодействие с 
клиентами, которые обращаются в службу информационной поддержки, даже вне рабочего времени сервиса, устраняя ситуации, 
когда клиенты не получают своевременного ответа или перезвона со стороны сотрудников утром. Благодаря ассистенту
Language Model Assistant клиент сможет задавать вопросы и получать на них ответы в любое время суток, при любой нагрузке
на информационный сервис.
- Критерии успеха нашего проекта:
  - a. Кол-во запросов/ответов помощнику
  - б. Уменьшение средней продолжительности разговор на раб.смену сотрудников поддержки
  - в. Увеличение времени сессии клиента в нашем веб-приложение/сайте


## 1.2 Бизнес требования и ограничения 

Логика работы модуля:
- Пользователь заходит на сайт и в правом углу всплывает окно с нашим онлайн-собеседником
- Если в данный момент рабочее время суток, у пользователя есть выбор: либо оставить номер, для связи с ним в короткое 
время, либо задать вопрос виртуальному помощнику. В нерабочие часы существует возможность только задать вопрос онлайн 
помощнику
- Клиент задает вопрос, и получает ответ.
- Клиент может вести диалог с ассистентом
- После окончания диалога клиенту предлагается оценить работу ассистента, "лог" с диалогом отправляется в базу данных
для хранения. 

Бизнес-ограничения
- Клиент должен получить ответ не дольше чем за 10 секунд. 
- Первоначально модель должна быть расчитана на максимальную нагрузку 10 запросов минуту
- Модель должна работать на инференсе на видеокартах GPU 16gb. 
- Все пользователи должны быть ознакомлены с условием сохранения информации и использование в дальнейшем их запросов

## 1.3 Что входит в скоуп проекта/итерации, что не входит

**Задачи текущей итерации:**
- 
- Сбор и подготовка обучающих данных, включая разметку дополнительных данных
- Создание тестового набора вопрос/ответ для визуальной оценки качества работы моделей.
- Разработка и обучение модели машинного обучения.
- Интеграция модели в приложение или веб-сервис.
- Создание пользовательского интерфейса для "беседы" с виртуальным помощником.
- Тестирование приложения на предмет точности и производительности.


**Задачи, которые не входят в текущую итерацию:**
- Расширение функциональности общения (например построения графиков, таблиц, отображение изображений в диалоге).
- Оптимизация скорости модели для работы на мобильных устройствах.
- Разработка системы учета пользователей и их данных, для "вспоминания" истории беседы и продолжения работы с ней.

**Результат с точки зрения качества кода и воспроизводимости решения**
- Создание отдельного репозитория для кода приложения.
- Разработка модульной структуры приложения для упрощения сопровождения и расширения функциональности.

**Описание планируемого технического долга**
- Внедрение системы логирования для отслеживания работы приложения и обнаружения проблем.
- Разработка механизма авторизации пользователей для обеспечения безопасности данных и доступа к функциональности.


## 1.4. Предпосылки решения


**Проблема:** 
Пользователь заходит на сайт, и хочет получить консультацию быстро и прям сейчас. Ему неинтересно наше рабочее время. 
Ему интересно получить ответ прям сейчас. Если он не ходит ответ, он идет в гугл, и получает информацию, которая может 
быть некорректной. 


**Зачем нужен сервис (пример использования):**

1. Улучшение опыта клиентов: Пользователи могут получить мгновенные ответы на свои вопросы, ознакомиться с 
характеристиками автомобилей и ознакомиться с актуальными предложениями без необходимости ожидания ответа от живого 
оператора.
2. Круглосуточная доступность: Онлайн-бот доступен 24/7, что позволяет клиентам общаться и исследовать предложения 
в удобное для них время, даже в нерабочие часы.
3. Быстрое предоставление информации: Бот способен моментально предоставить информацию о моделях, ценах, наличии 
автомобилей, а также оформлении покупки и финансовых вопросах.
4. Автоматизация повторяющихся задач: Бот способен выполнять рутинные задачи, такие как рассылка брошюр, расчет 
стоимости автомобиля или запись на тест-драйв, что экономит время и ресурсы персонала.
5. Снижение нагрузки на службу поддержки: Благодаря боту, часть вопросов и запросов клиентов может быть решена 
автоматически, что освобождает операторов для более сложных и специализированных задач.
6. Создание лояльности клиентов: Предоставление удобства и мгновенной помощи может укрепить связь с клиентами 
и повысить вероятность успешных продаж.
7. Сбор данных и аналитика: Бот может собирать информацию о предпочтениях клиентов, 
что помогает в анализе и улучшении предложений.

## 2. Методология Data Scientist
### 2.1 Постановка задачи
Создание LLM онлайн-помощника.

### 2.2 Блок-схема
![Solution Block Diagram](./block_diagram.jpg "Solution Block Diagram")

### 2.3 Этапы решения задачи
### 2.3.1 Этап подготовки данных
Сбор данных: Для создания корпуса необходимо:
- выпарсить данные из открытых источников (например Wikipedia). Использовать рекурсивный подход поиска статьи по 
ключевым словам, таким как "Mercedes", "мерседес". Для закрытой внутренней версии продукта также необходимо создать 
корпус из внутренних данных по моделям и их комплектациям. Необходимо выпарсить форум Q/A с вопросами по машинам марки 
Mercedes.
- Собрать некоторую "легенду салона", которая будет подаваться в дальнейшем как context
- Прописать job, которая собирает из внутренней базы query(витрину) с available_product (С автомобилями которые 
доступны для покупки пользователю). Зафиксировать данную версию query для обучения модели. (Предусмотреть возможность
обновления данной квери в бакете по расписанию (В проде модель должна будет видеть только актуальную квери на каждом 
этапе))

MVP: csv файлы. В каждом датафрейме есть 3 колонки - url, context, status. (url - страница, с которой парсилась 
информация, context - текст с данной страницы, status - статус об операции с данной страницы.)
Возможные значения статусов: "Error" - с данной странице информацию получить не получилось, произошла ошибка,
"No find special words" - на данной странице нет ключевых слов (Таких, как mercedes, мерседес и т.д.), и "Ok" - данная 
страница была успешно обработана и на ней есть ключевые слова. Для Q/A форума необходимо создать аналогичный корпус.



### 2.3.2 Этап препроцессинга:
- Очистка данных. необходимо просмотреть корпус данных, почистить данные от символов разметки страниц и "мусорных" 
значений после парсинга.
- Создать "тестовый" набор вопрос, на котором мы будем оценивать качество работы моделей. 
(Пример вопроса: 'Чем mercedes cls класса отличается от e класса?', "Доступен ли тест-драйв в вашем салоне?", 
"Есть ли сейчас в наличие c180"?)

MVP: Проверка данных. Создания из них двух типов корпусов - первый, когда в каждой статье из вики присутсвуют ключевые 
слова и второй, которой создается из всех статей, скаченных рекурсионным подходом. Создать тестовый набор - должна быть
создана csv таблица содержащая две фичи - вопрос ответ. Основная часть вопросов  должна быть 
создана на основе современных материалов 2022-2023 года.


### 2.3.3 Этап создания baseline
- Рассмотреть LLM модели, доступные нам на русском языке
- Провести "тест-драйв" данных моделей
- Тонкая настройка: выбрать более удачные архитектуры (визуальная корреляция качества ответа и скорости работы) и 
и дообучить данные модели на нашем корпусе. (Использовать методы LoRa и др.)

MVP: notebook тетради, или логи с обучением/тестирования базовых моделей. По результатам должен быть выполнен отчёт.
Дообучение моделей. По возможности ресурсов допускается файнтюнинг не всех слоев модели, а только "головы". После 
фаинтюнинга модель должна быть оценена по loss-потерям. 


### 2.3.4 Этап оценки:
- Валидация: В процессе обучения проводить валидацию модели на тестовой выборке вопросов. Должен быть подготовлен 
pipeline-notebook, в котором при замене типа модели, все ячейки выполняются в дальнейшем автоматически и сохраняют \
результаты.

- Тестирование: По завершении обучения модель тестируется людьми, на качество вопросов. Модель тестируется на наличие 
"закрывающих" функций, на вопросы, на которые модель не должна отвечать. (Вопросы не касающиеся товаров марки mercedes)

MVP: Должны быть подготовлены ноутбуки с оценками качества моделей. Ответы модели на вопросы должны быть оценены
тестировочной группой по 5-бальной шкале. Где 5 - наилучший ответ модели, 0 - ответ модели совершенно неясен. В идеале 
модель работает с тестовой средой с заявленным качеством согласно бизнес-требованиям.

### 2.3.5 Интеграция в модель правил:
- Написание скриптов ограничивающих возможности ответа модели
- Создание скриптов, проверяющих запрос к модели по списку "запрещенных тем" 
(Список запрещенных тем согласовывается с заказчиком.  Заказчик имеет право изменять список как угодно на любой стадии разработки проекта)
- Модель не должна общаться на тематики, не относящиеся к теме портала
MVP: Наличие скриптов и правил, для первичной фильтрации запроса. Если запрос имеет "стоп-слова", или система фильтрации 
не пропускает данный вопрос, ответом должно быть сообщение-заглушка.


### 2.3.6 Расчет системных требований для модели
- Расчёт мощностей, необходимых для обучения модели и для ее инференса. Оптимизация модели. 
- Проверка соответствия с требованием заказчика. Дополнительное согласование, если требования различны.
MVP: Составлен список требований для модели. При выполнении оптимизации модели, необходима дополнительная проверка 
качества модели. 


## 3. Подготовка пилота проекта

- Утверждение полной архитектуры развертки пилота. Согласовываются методы хранения, дообучения, развертывания энд-поинта,
сбора данных после завершения диалогов и др. 
- Создается пилот проекта. Согласовывается и разрабатывается фронт-дизайн и дизайн группой. 
- Проводится тестирования пилота проекта тестировочной группой.

## 4. Архитетура решения 

"""
Тут будет схема 
"""